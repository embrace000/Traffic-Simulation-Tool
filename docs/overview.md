# 流量生成系统

## 重放流量

一种生成流量的简单方法是重放之前捕获的流量。重放流量即重放保存在pcap等流量文件中的数据包。一方面，可以按照原始流量的特征重放流量，另一方面，可以按照比例重放流量。按照原始流量的特征重放流量即在将原始流量的每一个数据包重发一次的基础上，考虑每个数据包之间的时间间隔。按照比例重放流量即可以设置各个节点之间的各类流量的占比。通过规定一个总量和各个流量的权重，计算各个流量应该包含多少数据包，并使用指定的原始pcap文件构造各个流量。对于各个节点，可以设置节点的IP和MAC地址。而对于节点间的流量，则可以设置流量的类型（如smtp、ftp等）、推迟多长时间开始等。对于第一种重放方式，可以设置各个流量的持续时间。而对于第二种重放方式，可以设置各个流量的发包速率和权重。要重放的流量是从记录了特定类型流量（如smtp、ftp等）的原始pcap文件中读取数据包信息后根据数据包信息构造的。对于第一种重放方式，还可以比较捕获的流量和原始pcap文件中数据包的信息的差异，例如数据包之间的时间间隔是否明显不同，或者相互对应的数据包的发送时间有所差异。

## 生成现实流量

重放的流量和现实流量有所差异，例如http流量可能伴随着dns流量，仅有http流量有时显得不真实。为了生成更加真实的流量，可以重现产生流量的场景来产生对应的流量。可以通过启动特定的容器来模拟客户端和服务器节点，客户端容器节点中运行着访问服务器容器节点所提供的服务的代码（例如请求网页、从ftp服务器下载文件等）。这种方式易于维护，在设置场景之前先构造好相应的容器镜像，在需要生成流量时启动所需的容器即可。对于各个节点，同样可以设置其IP和MAC地址。实现的代码先通过配置文件生成所需的场景，然后重放流量或者生成流量。配置文件中的内容可以临时存入数据库中待之后读取，但是重放流量所需的原始pcap文件和生成流量所需的容器镜像需要提前准备好。

## 记录流量

记录流量即记录一段时间内各个类型流量的占比以及发包的速率。系统将根据配置文件在指定的网络接口上记录不同类型的流量，并按照指定的时间间隔输出捕获信息，如间隔时间内捕获的数据包总量、各个类型数据包目前的总量和占比。

